# üì¶ zip-downloader

[![Tests](https://github.com/DeneesK/zip-downloader-11-07-2025/actions/workflows/zip-downloader-tests.yml/badge.svg)](https://github.com/DeneesK/zip-downloader-11-07-2025/actions/workflows/zip-downloader-tests.yml)

![Go version](https://img.shields.io/badge/go-1.22-blue)

–°–µ—Ä–≤–∏—Å –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ —Å—Å—ã–ª–∫–∞–º –∏ –∞—Ä—Ö–∏–≤–∞—Ü–∏–∏ –∏—Ö –≤ ZIP.

–ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ `.pdf`, `.jpeg`, `.jpg` —Ñ–∞–π–ª—ã, —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏—Ö –∏ –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –∏ —Ñ–∞–π–ª–æ–≤ –≤ –∑–∞–¥–∞—á–µ. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á –∏ in-memory-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞.

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫

–°–µ—Ä–≤–∏—Å –º–æ–∂–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, —Ç–∞–∫ –∏ —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥–∏ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.

### ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è         | –û–ø–∏—Å–∞–Ω–∏–µ                              | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é      |
|--------------------|----------------------------------------|-----------------------------|
| `SERVER_ADDRESS`   | –ê–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞                   | `localhost:8080`            |
| `ENV`              | –°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (`dev` –∏–ª–∏ `prod`)    | `dev`                       |
| `ARCHIVE_DIR`      | –ü—É—Ç—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏–≤–æ–≤              | `static/archives`           |
| `MAX_ACTIVE_TASKS` | –ú–∞–∫—Å–∏–º—É–º –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á                | `3`                         |
| `MAX_LINKS_PER_TASK` | –ú–∞–∫—Å–∏–º—É–º —Å—Å—ã–ª–æ–∫ –≤ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ       | `3`                         |

> –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ —Ñ–ª–∞–≥–∞–º–∏.

---

### üöÄ –ü—Ä–∏–º–µ—Ä –∑–∞–ø—É—Å–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export SERVER_ADDRESS=":8080"
export ENV="prod"
export ARCHIVE_DIR="./static/archives"
export MAX_ACTIVE_TASKS=3
export MAX_LINKS_PER_TASK=3

go run ./cmd/main.go
```

### –∏–ª–∏ –∑–∞–ø—É—Å–∫ —Å —Ñ–ª–∞–≥–∞–º–∏

```
go run ./cmd/main.go \
  -a ":8080" \
  -env "dev" \
  -dir "./static/archives" \
  -tasks 3 \
  -links 3
```

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ **3 —Å—Å—ã–ª–æ–∫** –Ω–∞ `.pdf`, `.jpeg`, `.jpg` —Ñ–∞–π–ª—ã
- –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á —Å –æ—á–µ—Ä–µ–¥—å—é
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, —É–ø–∞–∫–æ–≤–∫–∞ –≤ `.zip`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–¥–æ 3 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**
- –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏: `created`, `running`, `done`, `failed`
- In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–±–µ–∑ –ë–î –∏–ª–∏ Docker)

---

–ü–∞—Ç—Ç–µ—Ä–Ω—ã:
- **Dependency Injection** —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è**, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏—è
- **–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á** (`chan string`)
- **Worker loop** –¥–ª—è `processTask`


## üì° API

–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É `:8080`. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã ‚Äî –≤ —Ñ–æ—Ä–º–∞—Ç–µ `application/json`.

---

### 1. `POST /task` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –Ω–∞ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**

```bash
curl -X POST http://localhost:8080/task
```

### –û—Ç–≤–µ—Ç:

```
{
  "task_id": "b2f3f3f8-9234-4f5b-9f2c-1a6e4b3a1c12",
  "status": "created"
}
```

### –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:

- 201	–ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞
- 429	–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á

### 2. PATCH /task/{id} ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏
–î–æ–±–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫–∏ (–¥–æ 3) –∫ –∑–∞–¥–∞—á–µ. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ .pdf, .jpeg, .jpg.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**

```bash
curl -X PATCH http://localhost:8080/task/{task_id} \
  -H "Content-Type: application/json" \
  -d '{
    "links": [
      "https://example.com/file1.pdf",
      "https://example.com/image.jpeg"
    ]
  }'
```
### –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:

- 200	–°—Å—ã–ª–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- 400	–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç
- 404	–ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

### 2. GET /task/{id} ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏. –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ –∞—Ä—Ö–∏–≤.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**

```bash
curl http://localhost:8080/task/{task_id}
```

### –û—Ç–≤–µ—Ç:

```
{
  "task_id": "b2f3f3f8-9234-4f5b-9f2c-1a6e4b3a1c12",
  "status": "done",
  "archive": "http://localhost:8080/static/1a6e4b3a1c12.zip"
}
```

### –ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏

```
{
  "task_id": "b2f3f3f8-9234-4f5b-9f2c-1a6e4b3a1c12",
  "status": "failed",
  "failed_files": {
    "https://example.com/broken.pdf": "failed to download: 404 Not Found"
  }
}
```

### –ö–æ–¥—ã –æ—Ç–≤–µ—Ç–∞:

- 200	–ó–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞
- 404	–ó–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞